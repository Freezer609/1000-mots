<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>1000 Mots - RÃ©vision Vocabulaire</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" xintegrity="sha512-SnH5WK+bZxgPHs44uWIX+LLMD/Jp9v0H9S+t5W9qF/0m+y2iN1m2vN0k65B0x1L/K11g+B0+1rA==1" crossorigin="anonymous" referrerpolicy="no-referrer" />
    
    <style>
        :root {
            --color-background: #121212;
            --color-card: #1E1E1E;
            --color-text: #E0E0E0;
            --color-primary: #BB86FC; 
            --color-secondary: #03DAC6;
            --color-correct: #4CAF50;
            --color-incorrect: #F44336;
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--color-background);
            color: var(--color-text);
            display: flex;
            justify-content: center;
            align-items: flex-start;
            min-height: 100vh;
            margin: 0;
            padding: 20px;
            box-sizing: border-box;
        }

        .container {
            width: 100%;
            max-width: 800px;
            background-color: var(--color-card);
            padding: 40px;
            border-radius: 15px;
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.5);
            text-align: center;
            transition: opacity 0.3s ease-in-out; 
            min-height: 90vh;
        }

        .container.fade-out {
            opacity: 0;
        }

        h1 {
            font-weight: 700;
            font-size: 3em;
            margin-bottom: 20px;
            color: var(--color-text);
            text-align: left;
        }
        
        .alert-message {
            color: #FFFFFF;
            padding: 15px;
            border-radius: 10px;
            font-weight: 600;
            margin-bottom: 30px;
            text-align: left;
            display: none; 
            font-size: 0.9em;
        }

        .chapter-selector {
            display: flex;
            justify-content: flex-start;
            gap: 8px;
            margin-bottom: 30px;
            flex-wrap: wrap;
            padding: 5px 0;
        }
        
        .chapter-selector button {
            background-color: #333333;
            color: var(--color-text);
            border: none;
            padding: 8px 15px;
            font-size: 0.9em;
            font-weight: 700;
            border-radius: 6px;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        
        .chapter-selector button:hover {
            background-color: #444444;
        }

        .chapter-selector button.active {
            background-color: var(--color-primary);
            color: var(--color-card);
        }
        
        .mode-selector {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            margin-bottom: 40px;
        }

        .mode-selector button {
            background-color: #2C2C2C;
            color: var(--color-primary);
            border: 2px solid #2C2C2C;
            padding: 20px 10px;
            font-size: 1.1em;
            font-weight: 700;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            line-height: 1.3;
        }

        .mode-selector button:hover {
            border-color: var(--color-primary);
            transform: translateY(-2px);
        }

        .mode-selector button.active {
            background-color: var(--color-primary);
            color: var(--color-card);
            border-color: var(--color-primary);
            box-shadow: 0 0 15px rgba(187, 134, 252, 0.5);
        }
        
        .mode-selector button i {
            font-size: 1.5em;
            margin-bottom: 5px;
        }
        
        .mode-selector button.active i {
             color: var(--color-card);
        }
        .mode-selector button:not(.active) i {
             color: var(--color-primary);
        }
        
        .game-container {
            display: none;
            padding: 20px;
            background-color: #2C2C2C;
            border-radius: 12px;
            margin-bottom: 30px;
            min-height: 250px;
            flex-direction: column; 
            align-items: center;
            justify-content: center;
            
            opacity: 0;
            transition: opacity 0.35s ease-in-out;
            pointer-events: none;
        }
        
        .game-container.active-mode {
             pointer-events: auto;
        }
        
        .card-container {
            position: relative;
            width: 100%;
            height: 200px;
            perspective: 1000px;
            margin-bottom: 30px;
        }

        .card {
            position: absolute;
            width: 100%;
            height: 100%;
            transition: transform 0.6s;
            transform-style: preserve-3d;
            cursor: pointer;
        }

        .card.flipped {
            transform: rotateY(180deg);
        }

        .card-face {
            position: absolute;
            width: 100%;
            height: 100%;
            backface-visibility: hidden;
            border-radius: 10px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 2em;
            font-weight: 700;
            padding: 20px;
            box-sizing: border-box;
            word-wrap: break-word;
            text-align: center;
        }

        .card-front {
            background-color: #3A3A3A;
            color: var(--color-text);
        }

        .card-back {
            background-color: var(--color-primary);
            color: var(--color-card);
            transform: rotateY(180deg);
            font-size: 1.2em;
        }

        .controls {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 20px;
            margin-bottom: 20px;
        }
        
        #cardCounter, .quiz-score, #matchScore {
            font-size: 1.2em;
            font-weight: 700;
            color: var(--color-primary);
        }

        .feedback-buttons {
            display: none;
            flex-direction: row;
            gap: 15px;
            margin-top: 20px;
            justify-content: center;
        }

        .feedback-buttons button {
            width: 50%;
            padding: 15px;
            font-size: 1.1em;
            border-radius: 8px;
            border: none;
            font-weight: 700;
            cursor: pointer;
            color: var(--color-card);
            transition: background-color 0.3s;
        }

        .feedback-buttons .knew-it-btn {
            background-color: var(--color-correct);
        }
        .feedback-buttons .knew-it-btn:hover {
            background-color: #388E3C;
        }

        .feedback-buttons .didnt-know-it-btn {
            background-color: var(--color-incorrect);
        }
        .feedback-buttons .didnt-know-it-btn:hover {
            background-color: #D32F2F;
        }
        
        .quiz-question {
            font-size: 1.8em;
            font-weight: 700;
            margin-bottom: 30px;
            min-height: 80px;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
        }
        
        .quiz-options {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        #quizGameContainer .quiz-options button {
            padding: 15px;
            background-color: transparent;
            color: var(--color-text);
            font-size: 1em;
            border-radius: 8px;
            transition: background-color 0.2s, border-color 0.2s; 
            border: 2px solid #555555;
            cursor: pointer;
            font-weight: 500;
        }
        
        #quizGameContainer .quiz-options button:hover:not(.correct):not(.incorrect) {
            background-color: #444444;
            border-color: var(--color-primary);
        }

        #quizGameContainer .quiz-options button.correct {
            background-color: var(--color-correct);
            color: var(--color-card);
            border-color: var(--color-correct);
        }

        #quizGameContainer .quiz-options button.incorrect {
            background-color: var(--color-incorrect);
            color: var(--color-card);
            border-color: var(--color-incorrect);
        }

        .hangman-drawing {
            margin: 20px auto;
            max-width: 200px;
        }
        .hangman-word {
            font-size: 2.5em;
            letter-spacing: 12px;
            margin-bottom: 30px;
            font-weight: 700;
        }
        .hangman-letters {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            justify-content: center;
            margin-bottom: 20px;
        }
        .hangman-letters button {
            width: 45px;
            height: 45px;
            padding: 0;
            font-size: 1.1em;
            border-radius: 8px;
            background-color: #3A3A3A;
            color: var(--color-text);
            border: none;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        .hangman-letters button:hover:not(:disabled) {
            background-color: #444444;
        }
        .hangman-letters button:disabled {
            background-color: #222222;
            color: #555555;
            cursor: not-allowed;
        }

        #scrambleInput, #dictationInput {
            padding: 15px;
            width: 90%;
            max-width: 450px;
            border: 2px solid var(--color-primary);
            border-radius: 8px;
            font-size: 1.5em;
            text-align: center;
            background-color: #333333;
            color: var(--color-text);
            transition: border-color 0.3s, box-shadow 0.3s;
        }

        #scrambleInput:focus, #dictationInput:focus {
            outline: none;
            border-color: var(--color-secondary);
            box-shadow: 0 0 10px rgba(3, 218, 198, 0.5);
        }

        .scramble-clue, .dictation-clue {
            font-size: 1.1em;
            color: #AAAAAA;
            margin-bottom: 20px;
            min-height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
        }
        
        .scramble-feedback, .dictation-feedback {
            font-weight: 700;
            margin-top: 10px;
            min-height: 20px;
            font-size: 1.1em;
        }

        .game-container button:not(#scrambleNextBtn, #dictationNextBtn, #matchNextBtn) {
            background-color: var(--color-primary);
            color: var(--color-card);
            border: none;
            padding: 12px 25px;
            font-size: 1em;
            font-weight: 700;
            border-radius: 8px;
            cursor: pointer;
            transition: background-color 0.3s, transform 0.2s, box-shadow 0.3s;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
            margin-top: 20px;
        }

        .game-container button:hover:not(:disabled, #scrambleNextBtn, #dictationNextBtn, #matchNextBtn) {
            background-color: #A052EE;
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.4);
        }
        
        #scrambleNextBtn, #dictationNextBtn, #matchNextBtn {
            background-color: var(--color-secondary);
            color: var(--color-card);
            border: none;
            padding: 12px 25px;
            font-size: 1em;
            font-weight: 700;
            border-radius: 8px;
            cursor: pointer;
            transition: background-color 0.3s, transform 0.2s, box-shadow 0.3s;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
            margin-top: 20px;
        }

        #scrambleNextBtn:hover, #dictationNextBtn:hover, #matchNextBtn:hover {
            background-color: #018786;
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.4);
        }

        #matchGrid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 20px;
            width: 100%;
        }

        .match-column {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .match-item {
            padding: 15px;
            background-color: #3A3A3A;
            color: var(--color-text);
            border-radius: 8px;
            cursor: pointer;
            transition: background-color 0.3s, transform 0.1s, border 0.3s;
            text-align: left;
            font-size: 0.9em;
            min-height: 50px;
            display: flex;
            align-items: center;
            border: 2px solid transparent;
        }

        .match-item:hover:not(.matched):not(.error) {
            background-color: #444444;
        }

        .match-item.selected {
            border-color: var(--color-primary);
            background-color: #3A3A3A;
            transform: scale(1.02);
        }

        .match-item.matched {
            background-color: var(--color-correct);
            color: var(--color-card);
            cursor: default;
            pointer-events: none;
            opacity: 1; 
            border-color: transparent;
        }

        .match-item.error {
            background-color: var(--color-incorrect);
            color: var(--color-card);
            animation: shake 0.5s;
            border-color: transparent;
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0);
            }
            20%, 60% { transform: translateX(-5px);
            }
            40%, 80% { transform: translateX(5px);
            }
        }

        details {
            margin-top: 25px;
            background-color: #2C2C2C;
            border-radius: 10px;
            overflow: hidden; 
        }
        
        summary {
            font-size: 1.2em;
            font-weight: 700;
            padding: 20px;
            cursor: pointer;
            outline: none;
            color: var(--color-secondary);
            list-style: none;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: background-color 0.2s;
        }

        summary:hover {
            background-color: #3A3A3A;
        }

        summary::after {
            content: '\25BC';
            margin-left: 10px;
            transition: transform 0.3s;
        }

        details[open] summary::after {
            content: '\25B2';
        }
        
        .list-content, .instructions-content {
            padding: 0 20px 20px 20px;
            text-align: left;
            
            max-height: 0;
            transition: max-height 0.4s ease-out, border-top 0.4s;
            overflow: hidden; 
            border-top: none;
        }
        
        details[open] .list-content,
        details[open] .instructions-content {
            max-height: 2000px;
            border-top: 1px solid #444444; 
        }

        .vocabulary-list {
            columns: 2;
            column-gap: 40px;
            font-size: 0.9em;
            line-height: 1.8;
            padding-left: 20px;
            margin-top: 15px;
        }
        .vocabulary-list li {
            margin-bottom: 5px;
        }

        .instructions-content p {
            margin-top: 15px;
            line-height: 1.6;
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 100;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0, 0, 0, 0.7);
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            background-color: #2C2C2C;
            margin: auto;
            padding: 30px;
            border-radius: 15px;
            width: 80%;
            max-width: 400px;
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.7);
            text-align: center;
            transform: translateY(-20px);
            opacity: 0;
            animation: fadeIn 0.3s forwards ease-out;
        }

        @keyframes fadeIn {
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .modal-content h3 {
            color: var(--color-primary);
            margin-bottom: 25px;
            font-size: 1.5em;
        }

        .modal-buttons {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .modal-buttons button {
            width: 100%;
            padding: 15px;
            font-size: 1.1em;
            font-weight: 700;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            color: var(--color-card);
            transition: background-color 0.3s, transform 0.2s;
        }

        .modal-buttons button:hover {
            transform: translateY(-2px);
            opacity: 0.9;
        }
        
        @media (max-width: 600px) {
            body {
                padding: 10px;
            }
            .container {
                padding: 20px 15px;
                min-height: 95vh;
            }
            h1 {
                font-size: 2em;
                margin-bottom: 15px;
            }
            
            .chapter-selector {
                justify-content: center;
            }
            .chapter-selector button {
                flex-grow: 1;
                min-width: unset;
                padding: 10px;
            }
            
            .mode-selector {
                grid-template-columns: repeat(2, 1fr);
                gap: 15px;
            }
            
            .mode-selector button {
                padding: 15px 10px;
                font-size: 0.9em;
            }
            
            .card-face {
                font-size: 1.5em;
            }
            
            .card-back {
                font-size: 1em;
            }

            .controls {
                gap: 10px;
            }
            
            .feedback-buttons {
                 flex-direction: column;
                gap: 10px;
            }
            
            .feedback-buttons button {
                width: 100%;
                font-size: 1em;
                padding: 12px;
            }

            .quiz-options {
                grid-template-columns: 1fr;
                gap: 10px;
            }
            .quiz-options button {
                font-size: 0.9em;
                padding: 12px;
            }
            
            .hangman-word {
                font-size: 1.8em;
                letter-spacing: 8px;
            }
            .hangman-letters button {
                width: 38px;
                height: 38px;
                font-size: 0.9em;
            }

            #scrambleInput, #dictationInput {
                font-size: 1.2em;
                padding: 12px;
            }
            .scramble-clue, .dictation-clue {
                font-size: 1em;
            }
            .game-container button {
                padding: 10px 20px;
                font-size: 0.9em;
            }
            
            #matchGrid {
                grid-template-columns: 1fr;
                gap: 15px;
            }
            .match-item {
                font-size: 0.85em;
                padding: 12px;
                min-height: 45px;
            }

            summary {
                font-size: 1.1em;
                padding: 15px;
            }
            .list-content, .instructions-content {
                padding: 0 15px 15px 15px;
            }
            .vocabulary-list {
                padding-left: 15px;
                font-size: 0.85em;
            }
            .modal-content {
                width: 90%;
                padding: 20px;
            }
            .modal-content h3 {
                font-size: 1.3em;
                margin-bottom: 20px;
            }
            .modal-buttons button {
                font-size: 1em;
                padding: 12px;
            }
            
             /* Fix du bouton admin sur mobile */
            #adminButton {
                 bottom: 10px;
                 right: 10px;
            }

            #adminPanel {
                 width: 90%;
                 max-width: unset;
                 right: 5%;
                 left: 5%;
                 bottom: 60px;
            }
        }
        
        /* --- NOUVEAU CSS ADMIN --- */
        #adminButton {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background-color: var(--color-primary);
            color: var(--color-card);
            border: none;
            padding: 10px 15px;
            font-size: 0.9em;
            font-weight: 700;
            border-radius: 5px;
            cursor: pointer;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.5);
            z-index: 50; 
        }

        #adminButton.unlocked {
            background-color: var(--color-secondary); 
        }

        #adminPanel {
            display: none;
            position: fixed;
            bottom: 70px;
            right: 20px;
            width: 300px;
            background-color: #2C2C2C;
            border-radius: 8px;
            padding: 15px;
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.7);
            z-index: 50;
            text-align: left;
            max-height: 80vh;
            overflow-y: auto;
        }

        #adminPanel h3 {
            color: var(--color-secondary);
            font-size: 1.2em;
            margin-bottom: 10px;
        }

        #adminPanel button {
            width: 100%;
            background-color: #3A3A3A;
            color: var(--color-text);
            padding: 10px;
            border: 1px solid #444444;
            border-radius: 5px;
            margin-bottom: 8px;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        #adminPanel button:hover {
            background-color: #444444;
        }

        #adminKeyInput {
            width: 100%;
            padding: 10px;
            margin-bottom: 10px;
            border-radius: 5px;
            border: 1px solid var(--color-primary);
            background-color: #1E1E1E;
            color: var(--color-text);
            box-sizing: border-box; /* Assure que le padding est inclus dans la width */
        }
        /* --- FIN NOUVEAU CSS ADMIN --- */
    </style>
</head>
<body>
    <div class="container">
        <h1 id="mainTitle">1000 MOTS</h1>
        <div id="chapterSelector" class="chapter-selector">
        </div>
        <div id="alertMessage" class="alert-message">
            <p id="alertText"></p>
        </div>
        <div class="mode-selector">
            <button id="flashcardModeBtn" class="active" title="Mode Cartes"><i class="fas fa-redo-alt"></i> Mode Cartes</button>
            <button id="quizModeBtn" title="Mode Quiz"><i class="fas fa-question-circle"></i> Mode Quiz</button>
            <button id="hangmanModeBtn" title="Mode Pendu"><i class="fas fa-user-slash"></i> Mode Pendu</button>
            <button id="scrambleModeBtn" title="Mode RÃ©arrangement"><i class="fas fa-random"></i> Mots MÃ©langÃ©s</button>
            <button id="dictationModeBtn" title="Mode DictÃ©e"><i class="fas fa-keyboard"></i> Mode DictÃ©e</button>
            <button id="matchModeBtn" title="Mode Match"><i class="fas fa-link"></i> Mode Association</button>
        </div>

        <div id="flashcardGameContainer" class="game-container active-mode" style="display: flex; opacity: 1;">
            <div class="card-container">
                <div id="flashcard" class="card">
                    <div id="front" class="card-face card-front">SÃ©lectionnez un chapitre ci-dessus</div>
                    <div id="back" class="card-face card-back">Puis une section pour commencer Ã  jouer.</div>
                </div>
            </div>
            <div class="controls"> 
                <span id="cardCounter"></span>
            </div>
            <div class="feedback-buttons" id="feedbackButtons">
                <button class="knew-it-btn" id="knewItBtn">Je l'avais</button>
                <button class="didnt-know-it-btn" id="didntKnowBtn">Je ne l'avais pas</button>
            </div>
        </div>

        <div id="quizGameContainer" class="game-container">
            <div id="quizScore" class="quiz-score">Score: 0 / 0</div>
            <div id="quizQuestion" class="quiz-question"></div>
            <div id="quizOptions" class="quiz-options"></div>
        </div>

        <div id="hangmanGameContainer" class="game-container">
             <svg class="hangman-drawing" viewBox="0 0 200 200">
                <line x1="10" y1="190" x2="150" y2="190" stroke="#fff" stroke-width="4" />
                <line x1="40" y1="190" x2="40" y2="20" stroke="#fff" stroke-width="4" />
                <line x1="40" y1="20" x2="120" y2="20" stroke="#fff" stroke-width="4" />
                <line x1="120" y1="20" x2="120" y2="40" stroke="#fff" stroke-width="4" />

                <circle id="head" cx="120" cy="55" r="15" stroke="#fff" stroke-width="3" fill="none" style="display:none" />
                <line id="body" x1="120" y1="70" x2="120" y2="120" stroke="#fff" stroke-width="3" style="display:none" />
                <line id="arm1" x1="120" y1="80" x2="100" y2="100" stroke="#fff" stroke-width="3" style="display:none" />
                <line id="arm2" x1="120" y1="80" x2="140" y2="100" stroke="#fff" stroke-width="3" style="display:none" />
                <line id="leg1" x1="120" y1="120" x2="100" y2="150" stroke="#fff" stroke-width="3" style="display:none" />
                <line id="leg2" x1="120" y1="120" x2="140" y2="150" stroke="#fff" stroke-width="3" style="display:none" />
            </svg>
            <div id="hangmanWord" class="hangman-word"></div>
            <div id="hangmanLetters" class="hangman-letters"></div>
        </div>

        <div id="scrambleGameContainer" class="game-container">
            <div id="scrambleWord" class="quiz-question"></div>
            <div id="scrambleClue" class="scramble-clue"></div>
            <input type="text" id="scrambleInput" placeholder="Ãcris le mot ici..." autocomplete="off">
            <button id="scrambleCheckBtn">VÃ©rifier</button>
            <div id="scrambleFeedback" class="scramble-feedback"></div>
            <button id="scrambleNextBtn" style="display:none;">Mot Suivant &rarr;</button>
        </div>

        <div id="dictationGameContainer" class="game-container">
            <div id="dictationClue" class="dictation-clue"></div>
            <input type="text" id="dictationInput" placeholder="Ãcris le mot exact ici..." autocomplete="off">
            <button id="dictationCheckBtn">VÃ©rifier</button>
            <div id="dictationFeedback" class="dictation-feedback"></div>
            <button id="dictationNextBtn" style="display:none;">Mot Suivant &rarr;</button>
        </div>

        <div id="matchGameContainer" class="game-container">
            <div id="matchScore">Paires trouvÃ©es : 0 / 6</div>
            <div id="matchGrid">
                <div id="wordsColumn" class="match-column"></div>
                <div id="definitionsColumn" class="match-column"></div>
            </div>
            <button id="matchNextBtn" style="display:none; margin-top: 30px;">Prochain Match &rarr;</button>
        </div>

        <details>
            <summary id="listTitle">Liste ComplÃ¨te</summary>
            <div class="list-content">
                <ul class="vocabulary-list"></ul>
            </div>
        </details>

        <details>
            <summary>Comment Utiliser</summary>
            <div class="instructions-content">
                <p>
                    - **SÃ©lecteur de Chapitre** : Choisis la catÃ©gorie de vocabulaire Ã  rÃ©viser en haut de la page.
                    - **Mode Cartes** : Clique sur la carte pour voir la dÃ©finition, puis dis si tu l'avais ou non. Les mots non connus reviendront plus souvent.
                    - **Mode Quiz** : Lis le mot ou la dÃ©finition et choisis la bonne rÃ©ponse.
                    - **Mode Pendu** : Devine le mot en cliquant sur les lettres.
                    - **Mots MÃ©langÃ©s** : Un mot est mÃ©langÃ©, retrouve le mot original avec l'aide de sa dÃ©finition.
                    - **Mode DictÃ©e** : Ãcris le mot exact correspondant Ã  la dÃ©finition. (Attention aux accents et Ã  l'orthographe exacte).
                    - **Mode Association** : Associe les mots Ã  leur dÃ©finition en cliquant sur une paire.
                </p>
            </div>
        </details>
    </div>

    <div id="categoryModal" class="modal">
        <div class="modal-content">
            <h3 id="modalTitle"></h3>
            <div id="modalButtons" class="modal-buttons">
            </div>
        </div>
    </div>
    
    <button id="adminButton">Admin</button>

    <div id="adminPanel">
        <h3 id="panelTitle">AccÃ¨s Admin (VerrouillÃ©)</h3>
        <input type="password" id="adminKeyInput" placeholder="Entrez la clÃ© secrÃ¨te">
        <button id="adminUnlockBtn">DÃ©verrouiller</button>

        <div id="adminContent" style="display: none; margin-top: 15px;">
            <p style="color: var(--color-primary); font-weight: bold; margin-bottom: 15px;">Le bridge est actif !</p>
            
            <button id="showCurrentVocabBtn">Afficher le Vocabulaire Actif (Console)</button>
            <button id="restartGameBtn">Relancer le Jeu de A Ã  Z</button>
            
            <hr style="margin: 10px 0; border-top: 1px solid #444;">
            
            <button id="logAllDataBtn">Voir TOUTES les DonnÃ©es (ALL_VOCAB_DATA)</button>
            
        </div>
    </div>

    <script src="vocab_data.js"></script>
    <script>
        const container = document.querySelector('.container');
        const flashcard = document.getElementById('flashcard');
        const frontFace = document.getElementById('front');
        const backFace = document.getElementById('back');
        const cardCounter = document.getElementById('cardCounter');
        const vocabularyList = document.querySelector('.vocabulary-list');
        const feedbackButtons = document.getElementById('feedbackButtons');
        const knewItBtn = document.getElementById('knewItBtn');
        const didntKnowBtn = document.getElementById('didntKnowBtn');

        const flashcardModeBtn = document.getElementById('flashcardModeBtn');
        const quizModeBtn = document.getElementById('quizModeBtn');
        const hangmanModeBtn = document.getElementById('hangmanModeBtn');
        const scrambleModeBtn = document.getElementById('scrambleModeBtn');
        const dictationModeBtn = document.getElementById('dictationModeBtn');
        const matchModeBtn = document.getElementById('matchModeBtn');

        const flashcardGameContainer = document.getElementById('flashcardGameContainer');
        const quizGameContainer = document.getElementById('quizGameContainer');
        const hangmanGameContainer = document.getElementById('hangmanGameContainer');
        const scrambleGameContainer = document.getElementById('scrambleGameContainer');
        const dictationGameContainer = document.getElementById('dictationGameContainer');
        const matchGameContainer = document.getElementById('matchGameContainer');
        const allContainers = [flashcardGameContainer, quizGameContainer, hangmanGameContainer, scrambleGameContainer, dictationGameContainer, matchGameContainer];
        const allModeBtns = [flashcardModeBtn, quizModeBtn, hangmanModeBtn, scrambleModeBtn, dictationModeBtn, matchModeBtn];

        const quizQuestion = document.getElementById('quizQuestion');
        const quizOptions = document.getElementById('quizOptions');
        const quizScore = document.getElementById('quizScore');

        const hangmanWordDiv = document.getElementById('hangmanWord');
        const hangmanLettersDiv = document.getElementById('hangmanLetters');
        const hangmanParts = ["head", "body", "arm1", "arm2", "leg1", "leg2"];

        const scrambleWordDiv = document.getElementById('scrambleWord');
        const scrambleClueDiv = document.getElementById('scrambleClue');
        const scrambleInput = document.getElementById('scrambleInput');
        const scrambleCheckBtn = document.getElementById('scrambleCheckBtn');
        const scrambleFeedbackDiv = document.getElementById('scrambleFeedback');
        const scrambleNextBtn = document.getElementById('scrambleNextBtn');

        const dictationClueDiv = document.getElementById('dictationClue');
        const dictationInput = document.getElementById('dictationInput');
        const dictationCheckBtn = document.getElementById('dictationCheckBtn');
        const dictationFeedbackDiv = document.getElementById('dictationFeedback');
        const dictationNextBtn = document.getElementById('dictationNextBtn');

        const matchScoreSpan = document.getElementById('matchScore');
        const wordsColumn = document.getElementById('wordsColumn');
        const definitionsColumn = document.getElementById('definitionsColumn');
        const matchNextBtn = document.getElementById('matchNextBtn');

        const chapterSelectorDiv = document.getElementById('chapterSelector');
        const listTitleSummary = document.getElementById('listTitle');
        const alertMessageDiv = document.getElementById('alertMessage');
        const alertTextP = document.getElementById('alertText');

        const categoryModal = document.getElementById('categoryModal');
        const modalTitle = document.getElementById('modalTitle');
        const modalButtons = document.getElementById('modalButtons');
        
        // --- NOUVEAUX ÃLÃMENTS ADMIN ---
        const adminButton = document.getElementById('adminButton');
        const adminPanel = document.getElementById('adminPanel');
        const adminUnlockBtn = document.getElementById('adminUnlockBtn');
        const adminKeyInput = document.getElementById('adminKeyInput');
        const adminContent = document.getElementById('adminContent');
        const panelTitle = document.getElementById('panelTitle');
        const showCurrentVocabBtn = document.getElementById('showCurrentVocabBtn');
        const restartGameBtn = document.getElementById('restartGameBtn');
        const logAllDataBtn = document.getElementById('logAllDataBtn');
        // -------------------------------

        const varCss = {
            colorCorrect: getComputedStyle(document.documentElement).getPropertyValue('--color-correct').trim(),
            colorIncorrect: getComputedStyle(document.documentElement).getPropertyValue('--color-incorrect').trim(),
            colorPrimary: getComputedStyle(document.documentElement).getPropertyValue('--color-primary').trim(),
            colorCard: getComputedStyle(document.documentElement).getPropertyValue('--color-card').trim(),
            colorText: getComputedStyle(document.documentElement).getPropertyValue('--color-text').trim(),
            colorSecondary: getComputedStyle(document.documentElement).getPropertyValue('--color-secondary').trim()
        };

        let vocab = [];
        let currentChapterKey = null;
        let currentSubcategoryKey = null;
        let chapterAlert = null;
        let chosenWord = '';
        let shuffledVocab = [];
        let currentCardIndex = 0;
        let masteredWords = new Set();

        let currentQuizQuestionIndex = 0;
        let quizQuestions = [];
        let score = { correct: 0, total: 0 };

        let hangmanWord = '';
        let guessedLetters = new Set();
        const maxErrors = hangmanParts.length;
        let errors = 0;

        let currentScrambleWord = '';
        let currentDictationWord = '';

        let matchPairs = [];
        let matchedPairsCount = 0;
        let selectedWordItem = null;
        let selectedDefItem = null;
        const MATCH_COUNT = 6;


        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        function hideAllGameContainers() {
            allContainers.forEach(container => {
                container.style.display = 'none';
                container.classList.remove('active-mode');
                setTimeout(() => container.style.opacity = '0', 0);
            });
            allModeBtns.forEach(btn => btn.classList.remove('active'));
        }

        function showGameContainer(container, button) {
            hideAllGameContainers();
            container.style.display = 'flex';
            button.classList.add('active');
            setTimeout(() => {
                container.classList.add('active-mode');
                container.style.opacity = '1';
            }, 50);
        }

        function displayAlert(message, color) {
            alertTextP.textContent = message;
            alertMessageDiv.style.backgroundColor = color;
            alertMessageDiv.style.display = 'block';
        }

        function hideAlert() {
            alertMessageDiv.style.display = 'none';
        }

        function generateChapterButtons() {
            chapterSelectorDiv.innerHTML = '';
            if (typeof ALL_VOCAB_DATA === 'undefined') return;

            Object.entries(ALL_VOCAB_DATA).forEach(([key, chapter]) => {
                const button = document.createElement('button');
                button.id = chapter.selectorId;
                button.textContent = chapter.title;
                button.addEventListener('click', () => openCategoryModal(key, chapter));
                chapterSelectorDiv.appendChild(button);
            });
        }

        function openCategoryModal(chapterKey, chapter) {
            
            document.querySelectorAll('.chapter-selector button').forEach(btn => btn.classList.remove('active'));
            document.getElementById(chapter.selectorId).classList.add('active');

            modalTitle.textContent = `Choisir la section pour ${chapter.title}`;
            modalButtons.innerHTML = '';
            
            Object.entries(chapter.subcategories).forEach(([subKey, subcategory]) => {
                const button = document.createElement('button');
                button.textContent = subcategory.name;
                button.style.backgroundColor = subcategory.color;
                button.style.color = '#1E1E1E';
                button.addEventListener('click', () => {
                    changeVocabulary(chapterKey, subKey);
                    categoryModal.style.display = 'none';
                });
                modalButtons.appendChild(button);
            });
            categoryModal.style.display = 'flex';
        }

        function changeVocabulary(chapterKey, subcategoryKey) {
            hideAllGameContainers();
            currentChapterKey = chapterKey;
            currentSubcategoryKey = subcategoryKey;
            
            if (typeof ALL_VOCAB_DATA === 'undefined') {
                displayAlert("Erreur: Fichier de donnÃ©es (vocab_data.js) manquant ou incorrect.", varCss.colorIncorrect);
                return;
            }

            const chapter = ALL_VOCAB_DATA[chapterKey];
            const subcategory = chapter.subcategories[subcategoryKey];
            vocab = subcategory.data;
            chapterAlert = subcategory.alert;

            listTitleSummary.textContent = `${chapter.title} - ${subcategory.name}`;

            if (chapterAlert && chapterAlert.message) {
                displayAlert(chapterAlert.message, chapterAlert.color || varCss.colorPrimary);
            } else {
                hideAlert();
            }

            generateList();
            startFlashcardGame();
        }

        function generateList() {
            vocabularyList.innerHTML = '';
            vocab.forEach(pair => {
                const li = document.createElement('li');
                li.textContent = `${pair[0]} - ${pair[1]}`;
                vocabularyList.appendChild(li);
            });
        }

        // --- Flashcard Logic ---

        function startFlashcardGame() {
            showGameContainer(flashcardGameContainer, flashcardModeBtn);
            flashcard.classList.remove('flipped');
            feedbackButtons.style.display = 'none';
            
            if (vocab.length === 0) {
                 frontFace.textContent = "SÃ©lectionnez un chapitre et une section.";
                 backFace.textContent = "Le jeu commencera aprÃ¨s la sÃ©lection.";
                 cardCounter.textContent = "";
                 return;
            }

            shuffledVocab = shuffleArray([...vocab]);
            currentCardIndex = 0;
            masteredWords = new Set();
            displayCard();
        }

        function displayCard() {
            if (shuffledVocab.length === 0) {
                frontFace.textContent = "Aucun mot Ã  rÃ©viser.";
                backFace.textContent = "";
                cardCounter.textContent = "0 / 0";
                return;
            }
            
            const [word, definition] = shuffledVocab[currentCardIndex];
            frontFace.textContent = word;
            backFace.innerHTML = definition;
            cardCounter.textContent = `${currentCardIndex + 1} / ${shuffledVocab.length}`;
            
            flashcard.classList.remove('flipped');
            feedbackButtons.style.display = 'none';
        }

        function flipCard() {
            if (vocab.length === 0) return;
            
            flashcard.classList.toggle('flipped');
            if (flashcard.classList.contains('flipped')) {
                feedbackButtons.style.display = 'flex';
            }
        }

        function handleFeedback(known) {
            const currentWord = shuffledVocab[currentCardIndex][0];
            
            if (known) {
                masteredWords.add(currentWord);
            } else {
                masteredWords.delete(currentWord);
                
                const wordToReinsert = shuffledVocab.splice(currentCardIndex, 1)[0];
                let insertIndex = currentCardIndex + Math.floor(Math.random() * (shuffledVocab.length - currentCardIndex)) + 1;
                if (insertIndex > shuffledVocab.length) insertIndex = shuffledVocab.length;
                shuffledVocab.splice(insertIndex, 0, wordToReinsert);
                currentCardIndex--; 
            }

            currentCardIndex++;
            if (currentCardIndex < shuffledVocab.length) {
                displayCard();
            } else {
                
                shuffledVocab = shuffledVocab.filter(pair => !masteredWords.has(pair[0]));
                if (shuffledVocab.length > 0) {
                    currentCardIndex = 0;
                    shuffleArray(shuffledVocab);
                    displayAlert(`Nouveau tour avec ${shuffledVocab.length} mots restants!`, varCss.colorPrimary);
                    displayCard();
                } else {
                    frontFace.textContent = "FÃ©licitations! Tu as maÃ®trisÃ© tous les mots!";
                    backFace.textContent = "Clique sur le bouton 'Mode Cartes' pour recommencer.";
                    cardCounter.textContent = "";
                    feedbackButtons.style.display = 'none';
                    flashcard.classList.remove('flipped');
                }
            }
        }

        flashcard.addEventListener('click', flipCard);
        knewItBtn.addEventListener('click', () => handleFeedback(true));
        didntKnowBtn.addEventListener('click', () => handleFeedback(false));

        // --- Quiz Logic ---

        function startQuizGame() {
            showGameContainer(quizGameContainer, quizModeBtn);
            if (vocab.length === 0) {
                quizQuestion.textContent = "SÃ©lectionnez un chapitre et une section pour commencer.";
                quizOptions.innerHTML = '';
                quizScore.textContent = "Score: 0 / 0";
                return;
            }

            shuffledVocab = shuffleArray([...vocab]);
            quizQuestions = generateQuizQuestions();
            currentQuizQuestionIndex = 0;
            score = { correct: 0, total: 0 };
            displayQuizQuestion();
        }

        function generateQuizQuestions() {
            return shuffledVocab.map(([word, definition]) => {
                const type = Math.random() < 0.5 ? 'wordToDef' : 'defToWord';
                const correctAnswer = type === 'wordToDef' ? definition : word;
                const question = type === 'wordToDef' ? word : definition;
                
                let incorrectAnswers = [];
                let tempVocab = vocab.filter(pair => pair[0] !== word);
                shuffleArray(tempVocab);

                while (incorrectAnswers.length < 3 && tempVocab.length > 0) {
                    const incorrectWord = type === 'wordToDef' ? tempVocab.pop()[1] : tempVocab.pop()[0];
                    if (!incorrectAnswers.includes(incorrectWord)) {
                        incorrectAnswers.push(incorrectWord);
                    }
                }
                
                const options = shuffleArray([correctAnswer, ...incorrectAnswers]).slice(0, 4);

                return { question, correctAnswer, options };
            });
        }

        function displayQuizQuestion() {
            hideAlert();
            if (currentQuizQuestionIndex >= quizQuestions.length) {
                quizQuestion.textContent = `Quiz terminÃ©! Ton score final : ${score.correct} / ${score.total}`;
                quizOptions.innerHTML = `<button onclick="startQuizGame()" style="background-color: ${varCss.colorSecondary}; color: ${varCss.colorCard}; border: none;">Recommencer le Quiz</button>`;
                return;
            }

            const q = quizQuestions[currentQuizQuestionIndex];
            quizQuestion.textContent = q.question;
            quizOptions.innerHTML = '';
            
            q.options.forEach(option => {
                const button = document.createElement('button');
                button.textContent = option;
                button.addEventListener('click', () => checkQuizAnswer(button, option, q.correctAnswer));
                quizOptions.appendChild(button);
            });
            updateQuizScore();
        }

        function checkQuizAnswer(button, selectedAnswer, correctAnswer) {
            score.total++;
            
            Array.from(quizOptions.children).forEach(btn => {
                btn.disabled = true;
                if (btn.textContent === correctAnswer) {
                    btn.classList.add('correct');
                } else if (btn.textContent === selectedAnswer) {
                    btn.classList.add('incorrect');
                }
            });

            if (selectedAnswer === correctAnswer) {
                score.correct++;
                displayAlert('Correct!', varCss.colorCorrect);
            } else {
                displayAlert(`Faux. La bonne rÃ©ponse Ã©tait : ${correctAnswer}`, varCss.colorIncorrect);
            }
            
            updateQuizScore();
            
            setTimeout(() => {
                currentQuizQuestionIndex++;
                displayQuizQuestion();
            }, 1500);
        }

        function updateQuizScore() {
            quizScore.textContent = `Score: ${score.correct} / ${score.total}`;
        }

        // --- Hangman Logic (Pendu Fix) ---

        function startHangGame() {
            showGameContainer(hangmanGameContainer, hangmanModeBtn);
             if (vocab.length === 0) {
                hangmanWordDiv.textContent = "SÃ©lectionnez un chapitre pour jouer.";
                hangmanLettersDiv.innerHTML = '';
                return;
            }

            hideAlert();
            
            const randomPair = shuffleArray([...vocab])[0];
            hangmanWord = randomPair[0].toUpperCase(); 
            guessedLetters = new Set();
            errors = 0;
            
            hangmanParts.forEach(id => document.getElementById(id).style.display = 'none');
            
            hangmanWordDiv.textContent = hangmanWord.split('').map(char => {
                if (char.match(/[A-ZÃ-Å¸]/i)) return '_';
                return char; 
            }).join(' ');

            generateHangButtons();
        }

        function generateHangButtons() {
            hangmanLettersDiv.innerHTML = '';
            
            const baseAlphabet = "ABCDEFGHIJKLMNOPQRSTUVWXYZ".split('');
            
            baseAlphabet.forEach(letter => {
                const button = document.createElement('button');
                button.textContent = letter;
                button.value = letter;
                button.addEventListener('click', () => guessLetter(letter, button));
                hangmanLettersDiv.appendChild(button);
            });
        }

        function guessLetter(letter, button) {
            if (button.disabled) return;

            button.disabled = true;
            hideAlert();

            const normalizedWord = hangmanWord.toUpperCase().normalize("NFD").replace(/[\u0300-\u036f]/g, "");
            const normalizedLetter = letter.toUpperCase().normalize("NFD").replace(/[\u0300-\u036f]/g, "");

            if (normalizedWord.includes(normalizedLetter)) {
                button.style.backgroundColor = varCss.colorCorrect;
                
                let updatedDisplay = '';
                let currentWordGuessed = '';
                
                for (let i = 0; i < hangmanWord.length; i++) {
                    const currentLetter = hangmanWord[i].toUpperCase();
                    const normalizedCurrentLetter = currentLetter.normalize("NFD").replace(/[\u0300-\u036f]/g, "");

                    if (normalizedCurrentLetter === normalizedLetter || guessedLetters.has(normalizedCurrentLetter)) {
                        updatedDisplay += currentLetter;
                        currentWordGuessed += currentLetter;
                        guessedLetters.add(normalizedCurrentLetter);
                    } else if (!currentLetter.match(/[A-ZÃ-Å¸]/i)) {
                         updatedDisplay += currentLetter;
                         currentWordGuessed += currentLetter;
                         guessedLetters.add(normalizedCurrentLetter);
                    }
                    else {
                        updatedDisplay += '_';
                        currentWordGuessed += '_';
                    }
                }
                
                hangmanWordDiv.textContent = updatedDisplay.split('').join(' ');

                if (!currentWordGuessed.includes('_')) {
                    displayAlert(`GagnÃ© ! Le mot Ã©tait : ${hangmanWord}`, varCss.colorCorrect);
                    disableHangButtons();
                }

            } else {
                button.style.backgroundColor = varCss.colorIncorrect;
                errors++;
                if (errors <= maxErrors) {
                    document.getElementById(hangmanParts[errors - 1]).style.display = 'block';
                }

                if (errors >= maxErrors) {
                    displayAlert(`Perdu ! Le mot Ã©tait : ${hangmanWord}`, varCss.colorIncorrect);
                    disableHangButtons();
                }
            }
        }

        function disableHangButtons() {
            Array.from(hangmanLettersDiv.children).forEach(btn => btn.disabled = true);
        }

        // --- Scramble Logic ---

        function scrambleWord(word) {
            const letters = word.split('');
            for (let i = letters.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [letters[i], letters[j]] = [letters[j], letters[i]];
            }
            return letters.join('');
        }

        function startScrambleGame() {
            showGameContainer(scrambleGameContainer, scrambleModeBtn);
            if (vocab.length === 0) {
                scrambleWordDiv.textContent = "SÃ©lectionnez un chapitre pour jouer.";
                scrambleClueDiv.textContent = "";
                scrambleInput.value = '';
                scrambleFeedbackDiv.textContent = '';
                scrambleNextBtn.style.display = 'none';
                scrambleCheckBtn.style.display = 'block';
                return;
            }

            hideAlert();
            scrambleInput.value = '';
            scrambleFeedbackDiv.textContent = '';
            scrambleNextBtn.style.display = 'none';
            scrambleCheckBtn.style.display = 'block';
            
            const randomPair = shuffleArray([...vocab])[0];
            currentScrambleWord = randomPair[0];
            const definition = randomPair[1];

            const scrambled = scrambleWord(currentScrambleWord.toUpperCase().replace(/[\s-]/g, '')); 

            scrambleWordDiv.textContent = scrambled.split('').join(' ');
            scrambleClueDiv.textContent = definition;
            scrambleInput.focus();
        }

        function checkScrambleAnswer() {
            const userAnswer = scrambleInput.value.trim().toUpperCase().normalize("NFD").replace(/[\u0300-\u036f]/g, "").replace(/[\s-]/g, '');
            const correctWord = currentScrambleWord.toUpperCase().normalize("NFD").replace(/[\u0300-\u036f]/g, "").replace(/[\s-]/g, '');

            scrambleCheckBtn.style.display = 'none';
            scrambleNextBtn.style.display = 'block';

            if (userAnswer === correctWord) {
                scrambleFeedbackDiv.textContent = `Correct! Le mot Ã©tait bien : ${currentScrambleWord}`;
                scrambleFeedbackDiv.style.color = varCss.colorCorrect;
            } else {
                scrambleFeedbackDiv.textContent = `Faux. Le mot correct Ã©tait : ${currentScrambleWord}`;
                scrambleFeedbackDiv.style.color = varCss.colorIncorrect;
            }
        }

        scrambleCheckBtn.addEventListener('click', checkScrambleAnswer);
        scrambleNextBtn.addEventListener('click', startScrambleGame);

        // --- Dictation Logic ---

        function startDictationGame() {
            showGameContainer(dictationGameContainer, dictationModeBtn);
             if (vocab.length === 0) {
                dictationClueDiv.textContent = "SÃ©lectionnez un chapitre pour jouer.";
                dictationInput.value = '';
                dictationFeedbackDiv.textContent = '';
                dictationNextBtn.style.display = 'none';
                dictationCheckBtn.style.display = 'block';
                return;
            }

            hideAlert();
            dictationInput.value = '';
            dictationFeedbackDiv.textContent = '';
            dictationNextBtn.style.display = 'none';
            dictationCheckBtn.style.display = 'block';

            const randomPair = shuffleArray([...vocab])[0];
            currentDictationWord = randomPair[0];
            const definition = randomPair[1];
            
            dictationClueDiv.textContent = definition;
            dictationInput.focus();
        }

        function checkDictationAnswer() {
            const userAnswer = dictationInput.value.trim();
            const correctWord = currentDictationWord;

            dictationCheckBtn.style.display = 'none';
            dictationNextBtn.style.display = 'block';
            
            if (userAnswer === correctWord) {
                dictationFeedbackDiv.textContent = `Exact! Le mot Ã©tait : ${correctWord}`;
                dictationFeedbackDiv.style.color = varCss.colorCorrect;
            } else {
                dictationFeedbackDiv.textContent = `Incorrect. Le mot exact Ã©tait : ${correctWord}`;
                dictationFeedbackDiv.style.color = varCss.colorIncorrect;
            }
        }

        dictationCheckBtn.addEventListener('click', checkDictationAnswer);
        dictationNextBtn.addEventListener('click', startDictationGame);

        // --- Match Logic ---

        function startMatchGame() {
            showGameContainer(matchGameContainer, matchModeBtn);
            if (vocab.length === 0) {
                 matchScoreSpan.textContent = "SÃ©lectionnez un chapitre pour jouer.";
                 wordsColumn.innerHTML = '';
                 definitionsColumn.innerHTML = '';
                 return;
            }

            hideAlert();
            wordsColumn.innerHTML = '';
            definitionsColumn.innerHTML = '';
            matchNextBtn.style.display = 'none';
            matchedPairsCount = 0;
            selectedWordItem = null;
            selectedDefItem = null;
            updateMatchScore();

            const pairs = shuffleArray([...vocab]).slice(0, MATCH_COUNT);
            matchPairs = pairs.map(([word, definition]) => ({ word, definition }));

            let words = shuffleArray(matchPairs.map(p => p.word));
            let definitions = shuffleArray(matchPairs.map(p => p.definition));

            words.forEach(word => createMatchItem(wordsColumn, word, 'word'));
            definitions.forEach(def => createMatchItem(definitionsColumn, def, 'definition'));
        }

        function createMatchItem(parent, content, type) {
            const item = document.createElement('div');
            item.classList.add('match-item');
            item.textContent = content;
            item.dataset.type = type;
            item.dataset.value = content;
            item.addEventListener('click', () => handleMatchSelection(item));
            parent.appendChild(item);
        }

        function getMatchPair(item1, item2) {
            const wordValue = item1.dataset.type === 'word' ? item1.dataset.value : item2.dataset.value;
            const defValue = item1.dataset.type === 'definition' ? item1.dataset.value : item2.dataset.value;

            return matchPairs.find(p => p.word === wordValue && p.definition === defValue);
        }

        function handleMatchSelection(item) {
            if (item.classList.contains('matched')) return;

            if (item.dataset.type === 'word') {
                if (selectedWordItem) selectedWordItem.classList.remove('selected');
                selectedWordItem = item;
            } else {
                if (selectedDefItem) selectedDefItem.classList.remove('selected');
                selectedDefItem = item;
            }

            item.classList.add('selected');

            if (selectedWordItem && selectedDefItem) {
                const wordItem = selectedWordItem;
                const defItem = selectedDefItem;

                const pair = getMatchPair(wordItem, defItem);

                if (pair) {
                    matchedPairsCount++;
                    wordItem.classList.remove('selected');
                    defItem.classList.remove('selected');
                    wordItem.classList.add('matched');
                    defItem.classList.add('matched');
                    updateMatchScore();

                    if (matchedPairsCount === MATCH_COUNT) {
                        displayAlert('FÃ©licitations! Toutes les paires trouvÃ©es.', varCss.colorCorrect);
                        matchNextBtn.style.display = 'block';
                    }
                } else {
                    wordItem.classList.add('error');
                    defItem.classList.add('error');
                    setTimeout(() => {
                        wordItem.classList.remove('error', 'selected');
                        defItem.classList.remove('error', 'selected');
                    }, 1000);
                }
                
                selectedWordItem = null;
                selectedDefItem = null;
            }
        }

        function updateMatchScore() {
            matchScoreSpan.textContent = `Paires trouvÃ©es : ${matchedPairsCount} / ${MATCH_COUNT}`;
        }

        matchNextBtn.addEventListener('click', startMatchGame);

        // --- Event Listeners GÃ©nÃ©raux ---

        flashcardModeBtn.addEventListener('click', startFlashcardGame);
        quizModeBtn.addEventListener('click', startQuizGame);
        hangmanModeBtn.addEventListener('click', startHangGame);
        scrambleModeBtn.addEventListener('click', startScrambleGame);
        dictationModeBtn.addEventListener('click', startDictationGame);
        matchModeBtn.addEventListener('click', startMatchGame);

        document.addEventListener('DOMContentLoaded', () => {
            generateChapterButtons(); 
            hideAlert();
            
            // Initialisation de la carte pour afficher le message d'attente
            frontFace.textContent = "SÃ©lectionnez un chapitre ci-dessus";
            backFace.textContent = "Puis une section pour commencer Ã  jouer.";
        });
        
        // --- Pont Admin SÃ©curisÃ© (AccÃ¨s Console & Panel) ---
        const ADMIN_SECRET_KEY = '4dm1nK3y';

        // Ouvre/ferme le panneau admin
        adminButton.addEventListener('click', () => {
            if (adminPanel.style.display === 'block') {
                adminPanel.style.display = 'none';
            } else {
                adminPanel.style.display = 'block';
                adminKeyInput.focus();
            }
        });

        // Fonction de dÃ©verrouillage
        window.unlockAdminBridge = function(key) {
            if (key === ADMIN_SECRET_KEY) {
                console.log("%cð ClÃ© Administrateur acceptÃ©e. Le pont admin est actif.", "color: " + varCss.colorSecondary + "; font-weight: bold;");
                
                // 1. Expose les donnÃ©es Ã  la console pour manipulation directe
                window.adminData = ALL_VOCAB_DATA;
                
                // 2. Met Ã  jour l'interface
                adminKeyInput.style.display = 'none';
                adminUnlockBtn.style.display = 'none';
                adminContent.style.display = 'block';
                panelTitle.textContent = "Panel Admin (DÃ©verrouillÃ©)";
                adminButton.classList.add('unlocked');
                adminKeyInput.value = '';
                
                return true;
            } else {
                console.error("ClÃ© secrÃ¨te incorrecte.");
                adminKeyInput.value = ''; // Efface le mot de passe
                displayAlert("ClÃ© admin incorrecte. Essayez Ã  nouveau.", varCss.colorIncorrect);
                return false;
            }
        };

        // ÃvÃ©nement pour le bouton "DÃ©verrouiller" du panel
        adminUnlockBtn.addEventListener('click', () => {
            unlockAdminBridge(adminKeyInput.value.trim());
        });
        
        // --- Fonctions d'exploitation du panel ---
        
        // 1. Affiche le vocabulaire actif
        showCurrentVocabBtn.addEventListener('click', () => {
             console.log("%c--- Vocabulaire ACTUELLEMENT ACTIF dans le jeu ---", "color: " + varCss.colorPrimary + "; font-weight: bold;");
             if (vocab.length > 0) {
                 console.log(vocab);
                 displayAlert(`Vocabulaire actif loguÃ© dans la console (${vocab.length} paires).`, varCss.colorPrimary);
             } else {
                 console.log("Aucun vocabulaire actif. Veuillez sÃ©lectionner un chapitre.");
                 displayAlert("Aucun vocabulaire actif. Veuillez sÃ©lectionner un chapitre.", varCss.colorIncorrect);
             }
        });
        
        // 2. Relance le jeu (rÃ©initialise l'Ã©tat)
        restartGameBtn.addEventListener('click', () => {
            if (currentChapterKey && currentSubcategoryKey) {
                // Relance le jeu avec le chapitre dÃ©jÃ  sÃ©lectionnÃ©
                changeVocabulary(currentChapterKey, currentSubcategoryKey);
                displayAlert(`Jeu redÃ©marrÃ© avec le chapitre : ${ALL_VOCAB_DATA[currentChapterKey].title}`, varCss.colorSecondary);
                adminPanel.style.display = 'none';
            } else {
                // Si rien n'est sÃ©lectionnÃ©, lance juste le mode par dÃ©faut
                startFlashcardGame(); 
                displayAlert("Interface de jeu redÃ©marrÃ©e (choisir un chapitre).", varCss.colorSecondary);
                adminPanel.style.display = 'none';
            }
        });

        // 3. Voir toutes les donnÃ©es
        logAllDataBtn.addEventListener('click', () => {
            console.log("%c--- TOUTES les DonnÃ©es de ALL_VOCAB_DATA ---", "color: " + varCss.colorSecondary + "; font-weight: bold;");
            console.log(window.adminData);
            displayAlert("TOUTES les donnÃ©es du fichier vocab_data.js ont Ã©tÃ© loguÃ©es dans la console.", varCss.colorPrimary);
        });

        // -------------------------------------------
    </script>
</body>
</html>
