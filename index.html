<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>1000 Mots - Révision Vocabulaire</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" xintegrity="sha512-SnH5WK+bZxgPHs44uWIX+LLMD/Jp9v0H9S+t5W9qF/0m+y2iN1m2vN0k65B0x1L/K11g+B0+1rA==1" crossorigin="anonymous" referrerpolicy="no-referrer" />
    
    <style>
        :root {
            --color-background: #121212;
            --color-card: #1E1E1E;
            --color-text: #E0E0E0;
            --color-primary: #BB86FC; 
            --color-secondary: #03DAC6;
            --color-correct: #4CAF50;
            --color-incorrect: #F44336;
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--color-background);
            color: var(--color-text);
            display: flex;
            justify-content: center;
            align-items: flex-start;
            min-height: 100vh;
            margin: 0;
            padding: 20px;
            box-sizing: border-box;
        }

        .container {
            width: 100%;
            max-width: 800px;
            background-color: var(--color-card);
            padding: 40px;
            border-radius: 15px;
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.5);
            text-align: center;
            transition: opacity 0.3s ease-in-out; 
            min-height: 90vh;
        }

        .container.fade-out {
            opacity: 0;
        }

        h1 {
            font-weight: 700;
            font-size: 3em;
            margin-bottom: 20px;
            color: var(--color-text);
            text-align: left;
        }
        
        .alert-message {
            color: #FFFFFF;
            padding: 15px;
            border-radius: 10px;
            font-weight: 600;
            margin-bottom: 30px;
            text-align: left;
            display: none; 
            font-size: 0.9em;
        }

        .chapter-selector {
            display: flex;
            justify-content: flex-start;
            gap: 8px;
            margin-bottom: 30px;
            flex-wrap: wrap;
            padding: 5px 0;
        }
        
        .chapter-selector button {
            background-color: #333333;
            color: var(--color-text);
            border: none;
            padding: 8px 15px;
            font-size: 0.9em;
            font-weight: 700;
            border-radius: 6px;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        
        .chapter-selector button:hover {
            background-color: #444444;
        }

        .chapter-selector button.active {
            background-color: var(--color-primary);
            color: var(--color-card);
        }
        
        .mode-selector {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            margin-bottom: 40px;
        }

        .mode-selector button {
            background-color: #2C2C2C;
            color: var(--color-primary);
            border: 2px solid #2C2C2C;
            padding: 20px 10px;
            font-size: 1.1em;
            font-weight: 700;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            line-height: 1.3;
        }

        .mode-selector button:hover {
            border-color: var(--color-primary);
            transform: translateY(-2px);
        }

        .mode-selector button.active {
            background-color: var(--color-primary);
            color: var(--color-card);
            border-color: var(--color-primary);
            box-shadow: 0 0 15px rgba(187, 134, 252, 0.5);
        }
        
        .mode-selector button i {
            font-size: 1.5em;
            margin-bottom: 5px;
        }
        
        .mode-selector button.active i {
             color: var(--color-card);
        }
        .mode-selector button:not(.active) i {
             color: var(--color-primary);
        }
        
        .game-container {
            display: none;
            padding: 20px;
            background-color: #2C2C2C;
            border-radius: 12px;
            margin-bottom: 30px;
            min-height: 250px;
            flex-direction: column; 
            align-items: center;
            justify-content: center;
            
            opacity: 0;
            transition: opacity 0.35s ease-in-out;
            pointer-events: none;
        }
        
        .game-container.active-mode {
             pointer-events: auto;
        }
        
        .card-container {
            position: relative;
            width: 100%;
            height: 200px;
            perspective: 1000px;
            margin-bottom: 30px;
        }

        .card {
            position: absolute;
            width: 100%;
            height: 100%;
            transition: transform 0.6s;
            transform-style: preserve-3d;
            cursor: pointer;
        }

        .card.flipped {
            transform: rotateY(180deg);
        }

        .card-face {
            position: absolute;
            width: 100%;
            height: 100%;
            backface-visibility: hidden;
            border-radius: 10px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 2em;
            font-weight: 700;
            padding: 20px;
            box-sizing: border-box;
            word-wrap: break-word;
            text-align: center;
        }

        .card-front {
            background-color: #3A3A3A;
            color: var(--color-text);
        }

        .card-back {
            background-color: var(--color-primary);
            color: var(--color-card);
            transform: rotateY(180deg);
            font-size: 1.2em;
        }

        .controls {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 20px;
            margin-bottom: 20px;
        }
        
        #cardCounter, .quiz-score, #matchScore {
            font-size: 1.2em;
            font-weight: 700;
            color: var(--color-primary);
        }

        .feedback-buttons {
            display: none;
            flex-direction: row;
            gap: 15px;
            margin-top: 20px;
            justify-content: center;
        }

        .feedback-buttons button {
            width: 50%;
            padding: 15px;
            font-size: 1.1em;
            border-radius: 8px;
            border: none;
            font-weight: 700;
            cursor: pointer;
            transition: background-color 0.3s;
            color: var(--color-card);
        }

        .feedback-buttons .knew-it-btn {
            background-color: var(--color-correct);
        }
        .feedback-buttons .knew-it-btn:hover {
            background-color: #388E3C;
        }

        .feedback-buttons .didnt-know-it-btn {
            background-color: var(--color-incorrect);
        }
        .feedback-buttons .didnt-know-it-btn:hover {
            background-color: #D32F2F;
        }
        
        .quiz-question {
            font-size: 1.8em;
            font-weight: 700;
            margin-bottom: 30px;
            min-height: 80px;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
        }
        
        .quiz-options {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        #quizGameContainer .quiz-options button {
            padding: 15px;
            background-color: transparent;
            color: var(--color-text);
            font-size: 1em;
            border-radius: 8px;
            transition: background-color 0.2s, border-color 0.2s; 
            border: 2px solid #555555;
            cursor: pointer;
            font-weight: 500;
        }
        
        #quizGameContainer .quiz-options button:hover:not(.correct):not(.incorrect) {
            background-color: #444444;
            border-color: var(--color-primary);
        }

        #quizGameContainer .quiz-options button.correct {
            background-color: var(--color-correct);
            color: var(--color-card);
            border-color: var(--color-correct);
        }

        #quizGameContainer .quiz-options button.incorrect {
            background-color: var(--color-incorrect);
            color: var(--color-card);
            border-color: var(--color-incorrect);
        }

        .hangman-drawing {
            margin: 20px auto;
            max-width: 200px;
        }
        .hangman-word {
            font-size: 2.5em;
            letter-spacing: 12px;
            margin-bottom: 30px;
            font-weight: 700;
        }
        .hangman-letters {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            justify-content: center;
            margin-bottom: 20px;
        }
        .hangman-letters button {
            width: 45px;
            height: 45px;
            padding: 0;
            font-size: 1.1em;
            border-radius: 8px;
            background-color: #3A3A3A;
            color: var(--color-text);
            border: none;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        .hangman-letters button:hover:not(:disabled) {
            background-color: #444444;
        }
        .hangman-letters button:disabled {
            background-color: #222222;
            color: #555555;
            cursor: not-allowed;
        }

        #scrambleInput, #dictationInput {
            padding: 15px;
            width: 90%;
            max-width: 450px;
            border: 2px solid var(--color-primary);
            border-radius: 8px;
            font-size: 1.5em;
            text-align: center;
            background-color: #333333;
            color: var(--color-text);
            transition: border-color 0.3s, box-shadow 0.3s;
        }

        #scrambleInput:focus, #dictationInput:focus {
            outline: none;
            border-color: var(--color-secondary);
            box-shadow: 0 0 10px rgba(3, 218, 198, 0.5);
        }

        .scramble-clue, .dictation-clue {
            font-size: 1.1em;
            color: #AAAAAA;
            margin-bottom: 20px;
            min-height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
        }
        
        .scramble-feedback, .dictation-feedback {
            font-weight: 700;
            margin-top: 10px;
            min-height: 20px;
            font-size: 1.1em;
        }

        .game-container button:not(#scrambleNextBtn, #dictationNextBtn, #matchNextBtn) {
            background-color: var(--color-primary);
            color: var(--color-card);
            border: none;
            padding: 12px 25px;
            font-size: 1em;
            font-weight: 700;
            border-radius: 8px;
            cursor: pointer;
            transition: background-color 0.3s, transform 0.2s, box-shadow 0.3s;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
            margin-top: 20px;
        }

        .game-container button:hover:not(:disabled, #scrambleNextBtn, #dictationNextBtn, #matchNextBtn) {
            background-color: #A052EE;
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.4);
        }
        
        #scrambleNextBtn, #dictationNextBtn, #matchNextBtn {
            background-color: var(--color-secondary);
            color: var(--color-card);
            border: none;
            padding: 12px 25px;
            font-size: 1em;
            font-weight: 700;
            border-radius: 8px;
            cursor: pointer;
            transition: background-color 0.3s, transform 0.2s, box-shadow 0.3s;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
            margin-top: 20px;
        }

        #scrambleNextBtn:hover, #dictationNextBtn:hover, #matchNextBtn:hover {
            background-color: #018786;
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.4);
        }

        #matchGrid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 20px;
            width: 100%;
        }

        .match-column {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .match-item {
            padding: 15px;
            background-color: #3A3A3A;
            color: var(--color-text);
            border-radius: 8px;
            cursor: pointer;
            transition: background-color 0.3s, transform 0.1s, border 0.3s;
            text-align: left;
            font-size: 0.9em;
            min-height: 50px;
            display: flex;
            align-items: center;
            border: 2px solid transparent;
        }

        .match-item:hover:not(.matched):not(.error) {
            background-color: #444444;
        }

        .match-item.selected {
            border-color: var(--color-primary);
            background-color: #3A3A3A;
            transform: scale(1.02);
        }

        .match-item.matched {
            background-color: var(--color-correct);
            color: var(--color-card);
            cursor: default;
            pointer-events: none;
            opacity: 1; 
            border-color: transparent;
        }

        .match-item.error {
            background-color: var(--color-incorrect);
            color: var(--color-card);
            animation: shake 0.5s;
            border-color: transparent;
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0);
            }
            20%, 60% { transform: translateX(-5px);
            }
            40%, 80% { transform: translateX(5px);
            }
        }

        details {
            margin-top: 25px;
            background-color: #2C2C2C;
            border-radius: 10px;
            overflow: hidden; 
        }
        
        summary {
            font-size: 1.2em;
            font-weight: 700;
            padding: 20px;
            cursor: pointer;
            outline: none;
            color: var(--color-secondary);
            list-style: none;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: background-color 0.2s;
        }

        summary:hover {
            background-color: #3A3A3A;
        }

        summary::after {
            content: '\25BC';
            margin-left: 10px;
            transition: transform 0.3s;
        }

        details[open] summary::after {
            content: '\25B2';
        }
        
        .list-content, .instructions-content {
            padding: 0 20px 20px 20px;
            text-align: left;
            
            max-height: 0;
            transition: max-height 0.4s ease-out, border-top 0.4s;
            overflow: hidden; 
            border-top: none;
        }
        
        details[open] .list-content,
        details[open] .instructions-content {
            max-height: 2000px;
            border-top: 1px solid #444444; 
        }

        .vocabulary-list {
            columns: 2;
            column-gap: 40px;
            font-size: 0.9em;
            line-height: 1.8;
            padding-left: 20px;
            margin-top: 15px;
        }
        .vocabulary-list li {
            margin-bottom: 5px;
        }

        .instructions-content p {
            margin-top: 15px;
            line-height: 1.6;
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 100;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0, 0, 0, 0.7);
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            background-color: #2C2C2C;
            margin: auto;
            padding: 30px;
            border-radius: 15px;
            width: 80%;
            max-width: 400px;
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.7);
            text-align: center;
            transform: translateY(-20px);
            opacity: 0;
            animation: fadeIn 0.3s forwards ease-out;
        }

        @keyframes fadeIn {
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .modal-content h3 {
            color: var(--color-primary);
            margin-bottom: 25px;
            font-size: 1.5em;
        }

        .modal-buttons {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .modal-buttons button {
            width: 100%;
            padding: 15px;
            font-size: 1.1em;
            font-weight: 700;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: background-color 0.3s, transform 0.2s;
            color: var(--color-card);
        }

        .modal-buttons button:hover {
            transform: translateY(-2px);
            opacity: 0.9;
        }
        
        @media (max-width: 600px) {
            body {
                padding: 10px;
            }
            .container {
                padding: 20px 15px;
                min-height: 95vh;
            }
            h1 {
                font-size: 2em;
                margin-bottom: 15px;
            }
            
            .chapter-selector {
                justify-content: center;
            }
            .chapter-selector button {
                flex-grow: 1;
                min-width: unset;
                padding: 10px;
            }
            
            .mode-selector {
                grid-template-columns: repeat(2, 1fr);
                gap: 15px;
            }
            
            .mode-selector button {
                padding: 15px 10px;
                font-size: 0.9em;
            }
            
            .card-face {
                font-size: 1.5em;
            }
            
            .card-back {
                font-size: 1em;
            }

            .controls {
                gap: 10px;
            }
            
            .feedback-buttons {
                 flex-direction: column;
                gap: 10px;
            }
            
            .feedback-buttons button {
                width: 100%;
                font-size: 1em;
                padding: 12px;
            }

            .quiz-options {
                grid-template-columns: 1fr;
                gap: 10px;
            }
            .quiz-options button {
                font-size: 0.9em;
                padding: 12px;
            }
            
            .hangman-word {
                font-size: 1.8em;
                letter-spacing: 8px;
            }
            .hangman-letters button {
                width: 38px;
                height: 38px;
                font-size: 0.9em;
            }

            #scrambleInput, #dictationInput {
                font-size: 1.2em;
                padding: 12px;
            }
            .scramble-clue, .dictation-clue {
                font-size: 1em;
            }
            .game-container button {
                padding: 10px 20px;
                font-size: 0.9em;
            }
            
            #matchGrid {
                grid-template-columns: 1fr;
                gap: 15px;
            }
            .match-item {
                font-size: 0.85em;
                padding: 12px;
                min-height: 45px;
            }

            summary {
                font-size: 1.1em;
                padding: 15px;
            }
            .list-content, .instructions-content {
                padding: 0 15px 15px 15px;
            }
            .vocabulary-list {
                padding-left: 15px;
                font-size: 0.85em;
            }
            .modal-content {
                width: 90%;
                padding: 20px;
            }
            .modal-content h3 {
                font-size: 1.3em;
                margin-bottom: 20px;
            }
            .modal-buttons button {
                font-size: 1em;
                padding: 12px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1 id="mainTitle">1000 MOTS</h1>
        <div id="chapterSelector" class="chapter-selector">
        </div>
        <div id="alertMessage" class="alert-message">
            <p id="alertText"></p>
        </div>
        <div class="mode-selector">
            <button id="flashcardModeBtn" class="active" title="Mode Cartes"><i class="fas fa-redo-alt"></i> Mode Cartes</button>
            <button id="quizModeBtn" title="Mode Quiz"><i class="fas fa-question-circle"></i> Mode Quiz</button>
            <button id="hangmanModeBtn" title="Mode Pendu"><i class="fas fa-user-slash"></i> Mode Pendu</button>
            <button id="scrambleModeBtn" title="Mode Réarrangement"><i class="fas fa-random"></i> Mots Mélangés</button>
            <button id="dictationModeBtn" title="Mode Dictée"><i class="fas fa-keyboard"></i> Mode Dictée</button>
            <button id="matchModeBtn" title="Mode Match"><i class="fas fa-link"></i> Mode Association</button>
        </div>

        <div id="flashcardGameContainer" class="game-container">
            <div class="card-container">
                <div id="flashcard" class="card">
                    <div id="front" class="card-face card-front"></div>
                    <div id="back" class="card-face card-back"></div>
                </div>
            </div>
            <div class="controls"> 
                <span id="cardCounter"></span>
            </div>
            <div class="feedback-buttons" id="feedbackButtons">
                <button class="knew-it-btn" id="knewItBtn">Je l'avais</button>
                <button class="didnt-know-it-btn" id="didntKnowBtn">Je ne l'avais pas</button>
            </div>
        </div>

        <div id="quizGameContainer" class="game-container">
            <div id="quizScore" class="quiz-score">Score: 0 / 0</div>
            <div id="quizQuestion" class="quiz-question"></div>
            <div id="quizOptions" class="quiz-options"></div>
        </div>

        <div id="hangmanGameContainer" class="game-container">
             <svg class="hangman-drawing" viewBox="0 0 200 200">
                <line x1="10" y1="190" x2="150" y2="190" stroke="#fff" stroke-width="4" />
                <line x1="40" y1="190" x2="40" y2="20" stroke="#fff" stroke-width="4" />
                <line x1="40" y1="20" x2="120" y2="20" stroke="#fff" stroke-width="4" />
                <line x1="120" y1="20" x2="120" y2="40" stroke="#fff" stroke-width="4" />

                <circle id="head" cx="120" cy="55" r="15" stroke="#fff" stroke-width="3" fill="none" style="display:none" />
                <line id="body" x1="120" y1="70" x2="120" y2="120" stroke="#fff" stroke-width="3" style="display:none" />
                <line id="arm1" x1="120" y1="80" x2="100" y2="100" stroke="#fff" stroke-width="3" style="display:none" />
                <line id="arm2" x1="120" y1="80" x2="140" y2="100" stroke="#fff" stroke-width="3" style="display:none" />
                <line id="leg1" x1="120" y1="120" x2="100" y2="150" stroke="#fff" stroke-width="3" style="display:none" />
                <line id="leg2" x1="120" y1="120" x2="140" y2="150" stroke="#fff" stroke-width="3" style="display:none" />
            </svg>
            <div id="hangmanWord" class="hangman-word"></div>
            <div id="hangmanLetters" class="hangman-letters"></div>
        </div>

        <div id="scrambleGameContainer" class="game-container">
            <div id="scrambleWord" class="quiz-question"></div>
            <div id="scrambleClue" class="scramble-clue"></div>
            <input type="text" id="scrambleInput" placeholder="Écris le mot ici..." autocomplete="off">
            <button id="scrambleCheckBtn">Vérifier</button>
            <div id="scrambleFeedback" class="scramble-feedback"></div>
            <button id="scrambleNextBtn" style="display:none;">Mot Suivant &rarr;</button>
        </div>

        <div id="dictationGameContainer" class="game-container">
            <div id="dictationClue" class="dictation-clue"></div>
            <input type="text" id="dictationInput" placeholder="Écris le mot exact ici..." autocomplete="off">
            <button id="dictationCheckBtn">Vérifier</button>
            <div id="dictationFeedback" class="dictation-feedback"></div>
            <button id="dictationNextBtn" style="display:none;">Mot Suivant &rarr;</button>
        </div>
        
        <div id="matchGameContainer" class="game-container"> 
            <div id="matchScore">Paires trouvées : 0 / 6</div>
            <div id="matchGrid">
                <div id="wordsColumn" class="match-column"></div>
                <div id="definitionsColumn" class="match-column"></div>
            </div>
            <button id="matchNextBtn" style="display:none;
            margin-top: 30px;">Prochain Match &rarr;</button>
        </div>

        <details>
            <summary id="listTitle">Liste Complète</summary>
            <div class="list-content">
                <ul class="vocabulary-list"></ul>
            </div>
        </details>
        
        <details>
            <summary>Comment Utiliser</summary>
            <div class="instructions-content">
                <p>
                    - **Sélecteur de Chapitre** : Choisis la catégorie de vocabulaire à réviser en haut de la page.
                    - **Mode Cartes** : Clique sur la carte pour voir la définition, puis dis si tu l'avais ou non. Les mots non connus reviendront plus souvent.
                    - **Mode Quiz** : Lis le mot ou la définition et choisis la bonne réponse.
                    - **Mode Pendu** : Devine le mot en cliquant sur les lettres.
                    - **Mots Mélangés** : Un mot est mélangé, retrouve le mot original avec l'aide de sa définition.
                    - **Mode Dictée** : Écris le mot exact correspondant à la définition. (Attention aux accents et à l'orthographe exacte).
                    - **Mode Association** : Associe les mots à leur définition en cliquant sur une paire.
                </p>
            </div>
        </details>
    </div>

    <div id="categoryModal" class="modal">
        <div class="modal-content">
            <h3 id="modalTitle"></h3>
            <div id="modalButtons" class="modal-buttons">
            </div>
        </div>
    </div>

    <script src="vocab_data.js"></script>
    <script>
        const container = document.querySelector('.container');
        const flashcard = document.getElementById('flashcard');
        const frontFace = document.getElementById('front');
        const backFace = document.getElementById('back');
        const cardCounter = document.getElementById('cardCounter');
        const vocabularyList = document.querySelector('.vocabulary-list');
        const feedbackButtons = document.getElementById('feedbackButtons');
        const knewItBtn = document.getElementById('knewItBtn');
        const didntKnowBtn = document.getElementById('didntKnowBtn');
        
        const flashcardModeBtn = document.getElementById('flashcardModeBtn');
        const quizModeBtn = document.getElementById('quizModeBtn');
        const hangmanModeBtn = document.getElementById('hangmanModeBtn');
        const scrambleModeBtn = document.getElementById('scrambleModeBtn');
        const dictationModeBtn = document.getElementById('dictationModeBtn');
        const matchModeBtn = document.getElementById('matchModeBtn');

        const flashcardGameContainer = document.getElementById('flashcardGameContainer');
        const quizGameContainer = document.getElementById('quizGameContainer');
        const hangmanGameContainer = document.getElementById('hangmanGameContainer');
        const scrambleGameContainer = document.getElementById('scrambleGameContainer');
        const dictationGameContainer = document.getElementById('dictationGameContainer');
        const matchGameContainer = document.getElementById('matchGameContainer');
        
        const allContainers = [flashcardGameContainer, quizGameContainer, hangmanGameContainer, scrambleGameContainer, dictationGameContainer, matchGameContainer];
        const allModeBtns = [flashcardModeBtn, quizModeBtn, hangmanModeBtn, scrambleModeBtn, dictationModeBtn, matchModeBtn];

        const quizQuestion = document.getElementById('quizQuestion');
        const quizOptions = document.getElementById('quizOptions');
        const quizScore = document.getElementById('quizScore');

        const hangmanWordDiv = document.getElementById('hangmanWord');
        const hangmanLettersDiv = document.getElementById('hangmanLetters');
        const hangmanParts = ["head", "body", "arm1", "arm2", "leg1", "leg2"];

        const scrambleWordDiv = document.getElementById('scrambleWord');
        const scrambleClueDiv = document.getElementById('scrambleClue');
        const scrambleInput = document.getElementById('scrambleInput');
        const scrambleCheckBtn = document.getElementById('scrambleCheckBtn');
        const scrambleFeedbackDiv = document.getElementById('scrambleFeedback');
        const scrambleNextBtn = document.getElementById('scrambleNextBtn');

        const dictationClueDiv = document.getElementById('dictationClue');
        const dictationInput = document.getElementById('dictationInput');
        const dictationCheckBtn = document.getElementById('dictationCheckBtn');
        const dictationFeedbackDiv = document.getElementById('dictationFeedback');
        const dictationNextBtn = document.getElementById('dictationNextBtn');

        const matchScoreSpan = document.getElementById('matchScore');
        const wordsColumn = document.getElementById('wordsColumn');
        const definitionsColumn = document.getElementById('definitionsColumn');
        const matchNextBtn = document.getElementById('matchNextBtn');

        const chapterSelectorDiv = document.getElementById('chapterSelector');
        const listTitleSummary = document.getElementById('listTitle');
        
        const alertMessageDiv = document.getElementById('alertMessage');
        const alertTextP = document.getElementById('alertText');

        const categoryModal = document.getElementById('categoryModal');
        const modalTitle = document.getElementById('modalTitle');
        const modalButtons = document.getElementById('modalButtons');
        
        let vocab = []; 
        let currentChapterKey = null;
        let currentSubcategoryKey = null;
        let chapterAlert = null;

        let chosenWord = ''; 
        let shuffledVocab = []; 
        let currentCardIndex = 0;
        let masteredWords = new Set();
        let currentQuizQuestionIndex = 0;
        let quizQuestions = [];
        let score = { correct: 0, total: 0 };
        let hangmanWord = '';
        let guessedLetters = [];
        let maxErrors = hangmanParts.length;
        let errors = 0;
        let currentScrambleWord = '';
        let currentDictationWord = '';
        let matchPairs = [];
        let matchedPairsCount = 0;
        let selectedWordItem = null;
        let selectedDefItem = null;
        const MATCH_COUNT = 6;
        
        function hideAllGameContainers() {
            allContainers.forEach(container => {
                container.style.display = 'none';
                container.classList.remove('active-mode');
                setTimeout(() => container.style.opacity = '0', 0);
            });
            allModeBtns.forEach(btn => btn.classList.remove('active'));
        }

        function showGameContainer(container, button) {
            hideAllGameContainers();
            container.style.display = 'flex';
            button.classList.add('active');
            setTimeout(() => {
                 container.classList.add('active-mode');
                 container.style.opacity = '1';
            }, 50);
        }

        function displayAlert(message, color) {
            alertTextP.textContent = message;
            alertMessageDiv.style.backgroundColor = color;
            alertMessageDiv.style.display = 'block';
        }

        function hideAlert() {
            alertMessageDiv.style.display = 'none';
        }

        function generateChapterButtons() {
            chapterSelectorDiv.innerHTML = '';
            
            Object.entries(ALL_VOCAB_DATA).forEach(([key, chapter]) => {
                const button = document.createElement('button');
                button.id = chapter.selectorId;
                button.textContent = chapter.title;
                button.addEventListener('click', () => openCategoryModal(key, chapter));
                chapterSelectorDiv.appendChild(button);
            });
        }
        
        function openCategoryModal(chapterKey, chapter) {
            modalTitle.textContent = `Choisir la section pour ${chapter.title}`;
            modalButtons.innerHTML = '';

            Object.entries(chapter.subcategories).forEach(([subKey, subcategory]) => {
                const button = document.createElement('button');
                button.textContent = subcategory.name;
                button.style.backgroundColor = subcategory.color;
                button.style.color = '#1E1E1E';
                button.addEventListener('click', () => {
                    changeVocabulary(chapterKey, subKey);
                    categoryModal.style.display = 'none';
                });
                modalButtons.appendChild(button);
            });
            
            categoryModal.style.display = 'flex';
        }

        function changeVocabulary(chapterKey, subcategoryKey) {
            hideAllGameContainers();
            currentChapterKey = chapterKey;
            currentSubcategoryKey = subcategoryKey;
            
            const chapter = ALL_VOCAB_DATA[chapterKey];
            const subcategory = chapter.subcategories[subcategoryKey];

            vocab = subcategory.data;
            chapterAlert = subcategory.alert;
            
            listTitleSummary.textContent = `Liste Complète: ${chapter.title} - ${subcategory.name} (${vocab.length} mots)`;
            
            if (chapterAlert) {
                displayAlert(chapterAlert.message, chapterAlert.color);
            } else {
                hideAlert();
            }

            // Mettre à jour les boutons actifs
            chapterSelectorDiv.querySelectorAll('button').forEach(btn => {
                btn.classList.remove('active');
            });
            document.getElementById(chapter.selectorId).classList.add('active');

            // Réinitialiser le mode par défaut (Flashcard)
            startFlashcardGame();
            generateList();
        }

        // --- Flashcard Logic ---
        flashcardModeBtn.addEventListener('click', startFlashcardGame);
        flashcard.addEventListener('click', flipCard);
        knewItBtn.addEventListener('click', () => processCardFeedback(true));
        didntKnowBtn.addEventListener('click', () => processCardFeedback(false));

        function startFlashcardGame() {
            if (!vocab.length) return;
            showGameContainer(flashcardGameContainer, flashcardModeBtn);
            
            shuffledVocab = shuffleVocabForReview();
            masteredWords.clear(); 
            currentCardIndex = 0;
            updateFlashcard();
            feedbackButtons.style.display = 'none';
            flashcard.classList.remove('flipped');
        }
        
        function shuffleVocabForReview() {
            let priorityWords = [];
            let otherWords = [];
            
            vocab.forEach(pair => {
                if (masteredWords.has(pair[0])) {
                    otherWords.push(pair);
                } else {
                    // Les mots non maîtrisés ont plus de chance de revenir
                    priorityWords.push(pair, pair, pair); 
                }
                otherWords.push(pair);
            });
            
            let combined = [...priorityWords, ...otherWords];
            
            // Mélange de Fisher-Yates
            for (let i = combined.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [combined[i], combined[j]] = [combined[j], combined[i]];
            }
            return combined;
        }

        function updateFlashcard() {
            if (currentCardIndex >= shuffledVocab.length) {
                // Si la révision est terminée
                frontFace.textContent = 'Fini !';
                backFace.textContent = 'Prêt pour recommencer ?';
                cardCounter.textContent = 'Révision terminée !';
                feedbackButtons.style.display = 'none';
                flashcard.classList.remove('flipped');
                chosenWord = '';
                return;
            }

            chosenWord = shuffledVocab[currentCardIndex][0];
            const definition = shuffledVocab[currentCardIndex][1];

            frontFace.textContent = chosenWord;
            backFace.textContent = definition;
            cardCounter.textContent = `${currentCardIndex + 1} / ${shuffledVocab.length}`;
            
            flashcard.classList.remove('flipped');
            feedbackButtons.style.display = 'none';
        }

        function flipCard() {
            if (currentCardIndex < shuffledVocab.length) {
                flashcard.classList.toggle('flipped');
                if (flashcard.classList.contains('flipped')) {
                    feedbackButtons.style.display = 'flex';
                } else {
                    feedbackButtons.style.display = 'none';
                }
            }
        }
        
        function processCardFeedback(knewIt) {
            if (knewIt) {
                masteredWords.add(chosenWord);
            } else {
                masteredWords.delete(chosenWord);
                // Si l'utilisateur ne le savait pas, on le remet dans le tas plus tard
                shuffledVocab.splice(currentCardIndex + 3, 0, shuffledVocab[currentCardIndex]);
            }
            
            currentCardIndex++;
            updateFlashcard();
        }

        // --- Quiz Logic ---
        quizModeBtn.addEventListener('click', startQuizGame);

        function startQuizGame() {
            if (!vocab.length) return;
            showGameContainer(quizGameContainer, quizModeBtn);

            quizQuestions = generateQuizQuestions();
            currentQuizQuestionIndex = 0;
            score = { correct: 0, total: 0 };
            updateQuizScore();
            displayQuizQuestion();
        }

        function generateQuizQuestions() {
            const questions = [];
            
            // Shuffle the vocabulary once
            let tempVocab = [...vocab];
            for (let i = tempVocab.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [tempVocab[i], tempVocab[j]] = [tempVocab[j], tempVocab[i]];
            }
            
            tempVocab.forEach(pair => {
                const [word, correctDef] = pair;
                
                // Collect 3 random incorrect definitions
                let incorrectDefs = [];
                while (incorrectDefs.length < 3) {
                    const randomPair = vocab[Math.floor(Math.random() * vocab.length)];
                    const randomDef = randomPair[1];
                    // Ensure the definition is not the correct one and not already picked
                    if (randomDef !== correctDef && !incorrectDefs.includes(randomDef)) {
                        incorrectDefs.push(randomDef);
                    }
                }
                
                const options = [correctDef, ...incorrectDefs];
                
                // Shuffle options
                for (let i = options.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [options[i], options[j]] = [options[j], options[i]];
                }
                
                questions.push({
                    question: `Que signifie : **${word}** ?`,
                    correctAnswer: correctDef,
                    options: options
                });
            });
            
            return questions;
        }
        
        function updateQuizScore() {
            quizScore.textContent = `Score: ${score.correct} / ${score.total}`;
        }
        
        function displayQuizQuestion() {
            if (currentQuizQuestionIndex >= quizQuestions.length) {
                quizQuestion.textContent = `Quiz terminé ! Ton score final est de ${score.correct} sur ${score.total}.`;
                quizOptions.innerHTML = '';
                return;
            }

            const currentQ = quizQuestions[currentQuizQuestionIndex];
            quizQuestion.innerHTML = currentQ.question;
            quizOptions.innerHTML = '';

            currentQ.options.forEach(option => {
                const button = document.createElement('button');
                button.textContent = option;
                button.addEventListener('click', () => checkQuizAnswer(button, option, currentQ.correctAnswer));
                quizOptions.appendChild(button);
            });
            
            // Set chosenWord for potential admin access
            const wordMatch = currentQ.question.match(/\*\*(.*?)\*\*/);
            chosenWord = wordMatch ? wordMatch[1].trim() : '';
        }

        function checkQuizAnswer(selectedButton, selectedAnswer, correctAnswer) {
            score.total++;
            
            Array.from(quizOptions.children).forEach(button => {
                button.disabled = true; 
                if (button.textContent === correctAnswer) {
                    button.classList.add('correct');
                } else if (button.textContent === selectedAnswer) {
                    button.classList.add('incorrect');
                }
            });

            if (selectedAnswer === correctAnswer) {
                score.correct++;
            }
            
            updateQuizScore();
            
            setTimeout(() => {
                currentQuizQuestionIndex++;
                displayQuizQuestion();
            }, 1500);
        }

        // --- Hangman Logic ---
        hangmanModeBtn.addEventListener('click', startHangmanGame);

        function startHangmanGame() {
            if (!vocab.length) return;
            showGameContainer(hangmanGameContainer, hangmanModeBtn);
            
            const randomPair = vocab[Math.floor(Math.random() * vocab.length)];
            hangmanWord = randomPair[0].toUpperCase();
            chosenWord = randomPair[0];
            
            guessedLetters = [];
            errors = 0;
            
            hangmanParts.forEach(partId => document.getElementById(partId).style.display = 'none');
            
            updateHangmanDisplay();
            createLetterButtons();
        }

        function updateHangmanDisplay() {
            let displayWord = '';
            let wordComplete = true;
            for (const letter of hangmanWord) {
                if (letter === ' ') {
                    displayWord += ' ';
                } else if (guessedLetters.includes(letter)) {
                    displayWord += letter;
                } else {
                    displayWord += '_';
                    wordComplete = false;
                }
                displayWord += ' ';
            }
            hangmanWordDiv.textContent = displayWord.trim();
            
            if (wordComplete) {
                gameOver(true);
            } else if (errors >= maxErrors) {
                gameOver(false);
            }
        }
        
        function createLetterButtons() {
            hangmanLettersDiv.innerHTML = '';
            for (let i = 65; i <= 90; i++) {
                const letter = String.fromCharCode(i);
                const button = document.createElement('button');
                button.textContent = letter;
                button.addEventListener('click', () => handleGuess(letter, button));
                hangmanLettersDiv.appendChild(button);
            }
        }
        
        function handleGuess(letter, button) {
            button.disabled = true;
            
            if (hangmanWord.includes(letter)) {
                button.classList.add('correct');
            } else {
                button.classList.add('incorrect');
                errors++;
                document.getElementById(hangmanParts[errors - 1]).style.display = 'block';
            }
            
            updateHangmanDisplay();
        }
        
        function gameOver(win) {
            hangmanLettersDiv.querySelectorAll('button').forEach(btn => btn.disabled = true);
            
            if (win) {
                hangmanWordDiv.textContent = 'Gagné ! ' + hangmanWord;
            } else {
                hangmanWordDiv.textContent = 'Perdu ! Le mot était : ' + hangmanWord;
            }

            const restartBtn = document.createElement('button');
            restartBtn.textContent = 'Rejouer au Pendu';
            restartBtn.addEventListener('click', startHangmanGame);
            hangmanLettersDiv.appendChild(restartBtn);
        }

        // --- Scramble Logic ---
        scrambleModeBtn.addEventListener('click', startScrambleGame);
        scrambleCheckBtn.addEventListener('click', checkScrambleAnswer);
        scrambleNextBtn.addEventListener('click', startScrambleGame);

        function startScrambleGame() {
            if (!vocab.length) return;
            showGameContainer(scrambleGameContainer, scrambleModeBtn);
            
            const randomPair = vocab[Math.floor(Math.random() * vocab.length)];
            currentScrambleWord = randomPair[0].toLowerCase();
            const clue = randomPair[1];
            chosenWord = randomPair[0];
            
            const scrambled = scrambleWord(currentScrambleWord);
            
            scrambleWordDiv.textContent = scrambled.toUpperCase();
            scrambleClueDiv.textContent = `Indice : ${clue}`;
            scrambleInput.value = '';
            scrambleInput.focus();
            scrambleInput.disabled = false;
            scrambleCheckBtn.style.display = 'block';
            scrambleNextBtn.style.display = 'none';
            scrambleFeedbackDiv.textContent = '';
        }

        function scrambleWord(word) {
            let letters = word.split('');
            let vowels = 'aeiouyàéèêëïîôöùûüœæ'; 
            let consonants = 'bcdfghjklmnpqrstvwxz'; 
            
            // Tente de ne pas mettre la même lettre à la même place
            let maxAttempts = 10;
            let currentAttempt = 0;
            let originalWord = word.toLowerCase();
            let scrambledLetters = [...letters];

            while (currentAttempt < maxAttempts) {
                // Mélange
                for (let i = scrambledLetters.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [scrambledLetters[i], scrambledLetters[j]] = [scrambledLetters[j], scrambledLetters[i]];
                }
                
                let isDifferent = true;
                for (let i = 0; i < originalWord.length; i++) {
                    if (scrambledLetters[i] === originalWord[i]) {
                        isDifferent = false;
                        break;
                    }
                }
                
                if (isDifferent) {
                    return scrambledLetters.join('');
                }
                currentAttempt++;
            }
            
            // Si le mélange n'a pas réussi après maxAttempts
            return scrambledLetters.join(''); 
        }

        function checkScrambleAnswer() {
            const userAnswer = scrambleInput.value.toLowerCase().trim();
            
            if (userAnswer === currentScrambleWord) {
                scrambleFeedbackDiv.textContent = 'Correct !';
                scrambleFeedbackDiv.style.color = 'var(--color-correct)';
            } else {
                scrambleFeedbackDiv.textContent = `Faux. Le mot était : ${currentScrambleWord}`;
                scrambleFeedbackDiv.style.color = 'var(--color-incorrect)';
            }
            
            scrambleInput.disabled = true;
            scrambleCheckBtn.style.display = 'none';
            scrambleNextBtn.style.display = 'block';
        }

        // --- Dictation Logic ---
        dictationModeBtn.addEventListener('click', startDictationGame);
        dictationCheckBtn.addEventListener('click', checkDictationAnswer);
        dictationNextBtn.addEventListener('click', startDictationGame);

        function startDictationGame() {
            if (!vocab.length) return;
            showGameContainer(dictationGameContainer, dictationModeBtn);
            
            const randomPair = vocab[Math.floor(Math.random() * vocab.length)];
            currentDictationWord = randomPair[0];
            const clue = randomPair[1];
            chosenWord = randomPair[0];
            
            dictationClueDiv.textContent = `Définition : ${clue}`;
            dictationInput.value = '';
            dictationInput.focus();
            dictationInput.disabled = false;
            dictationCheckBtn.style.display = 'block';
            dictationNextBtn.style.display = 'none';
            dictationFeedbackDiv.textContent = '';
        }

        function checkDictationAnswer() {
            const userAnswer = dictationInput.value.trim();
            
            if (userAnswer === currentDictationWord) {
                dictationFeedbackDiv.textContent = 'Correct !';
                dictationFeedbackDiv.style.color = 'var(--color-correct)';
            } else {
                dictationFeedbackDiv.textContent = `Faux. La réponse exacte était : ${currentDictationWord}`;
                dictationFeedbackDiv.style.color = 'var(--color-incorrect)';
            }
            
            dictationInput.disabled = true;
            dictationCheckBtn.style.display = 'none';
            dictationNextBtn.style.display = 'block';
        }

        // --- Match Logic ---
        matchModeBtn.addEventListener('click', startMatchGame);

        function startMatchGame() {
            if (!vocab.length) return;
            showGameContainer(matchGameContainer, matchModeBtn);
            
            matchNextBtn.style.display = 'none';
            wordsColumn.innerHTML = '';
            definitionsColumn.innerHTML = '';
            selectedWordItem = null;
            selectedDefItem = null;
            matchedPairsCount = 0;
            
            // 1. Sélectionner 6 paires aléatoires
            const shuffledVocab = [...vocab].sort(() => 0.5 - Math.random());
            matchPairs = shuffledVocab.slice(0, MATCH_COUNT);

            // 2. Séparer les mots et les définitions
            const words = matchPairs.map(p => ({ text: p[0], id: p[0], type: 'word' }));
            const definitions = matchPairs.map(p => ({ text: p[1], id: p[0], type: 'def' }));

            // 3. Mélanger chaque colonne
            words.sort(() => 0.5 - Math.random());
            definitions.sort(() => 0.5 - Math.random());

            // 4. Afficher les éléments
            words.forEach(item => wordsColumn.appendChild(createMatchItem(item)));
            definitions.forEach(item => definitionsColumn.appendChild(createMatchItem(item)));
            
            updateMatchScore();
        }

        function createMatchItem(itemData) {
            const item = document.createElement('div');
            item.className = 'match-item';
            item.textContent = itemData.text;
            item.dataset.id = itemData.id; 
            item.dataset.type = itemData.type;
            item.addEventListener('click', () => handleMatchClick(item));
            return item;
        }

        function handleMatchClick(item) {
            if (item.classList.contains('matched') || item.classList.contains('error')) return;
            
            const isWord = item.dataset.type === 'word';
            
            if (isWord) {
                if (selectedWordItem) selectedWordItem.classList.remove('selected');
                selectedWordItem = item;
                item.classList.add('selected');
            } else {
                if (selectedDefItem) selectedDefItem.classList.remove('selected');
                selectedDefItem = item;
                item.classList.add('selected');
            }
            
            if (selectedWordItem && selectedDefItem) {
                checkMatch(selectedWordItem, selectedDefItem);
            }
        }

        function checkMatch(item1, item2) {
            // S'assurer que les deux éléments ne sont pas du même type (impossible normalement avec le code précédent, mais sécurité)
            if (item1.dataset.type === item2.dataset.type) {
                item1.classList.remove('selected');
                item2.classList.remove('selected');
                selectedWordItem = null;
                selectedDefItem = null;
                return;
            }

            // Le match est correct si leurs IDs (le mot d'origine) correspondent
            if (item1.dataset.id === item2.dataset.id) {
                // Match Correct
                item1.classList.add('matched');
                item2.classList.add('matched');
                item1.classList.remove('selected');
                item2.classList.remove('selected');
                matchedPairsCount++;
                updateMatchScore();
                
                if (matchedPairsCount === MATCH_COUNT) {
                    matchNextBtn.style.display = 'block';
                }
            } else {
                // Match Incorrect
                item1.classList.add('error');
                item2.classList.add('error');

                setTimeout(() => {
                    item1.classList.remove('error', 'selected');
                    item2.classList.remove('error', 'selected');
                }, 1000); 
            }
            
            selectedWordItem = null;
            selectedDefItem = null;
        }

        function updateMatchScore() {
            matchScoreSpan.textContent = `Paires trouvées : ${matchedPairsCount} / ${MATCH_COUNT}`;
        }

        matchNextBtn.addEventListener('click', startMatchGame);

        function generateList() {
            vocabularyList.innerHTML = '';
            vocab.forEach(pair => {
                const li = document.createElement('li');
                li.textContent = `${pair[0]} - ${pair[1]}`;
                vocabularyList.appendChild(li);
            });
        }

        document.addEventListener('DOMContentLoaded', () => {
            generateChapterButtons(); 
            hideAlert();
            
            if (typeof ALL_VOCAB_DATA !== 'undefined' && Object.keys(ALL_VOCAB_DATA).length > 0) {
                const defaultChapterKey = Object.keys(ALL_VOCAB_DATA)[0];
                const defaultChapter = ALL_VOCAB_DATA[defaultChapterKey];
                if (Object.keys(defaultChapter.subcategories).length === 1) {
                     const defaultSubKey = Object.keys(defaultChapter.subcategories)[0];
                     changeVocabulary(defaultChapterKey, defaultSubKey);
                } 
            }
        });
        
        const ADMIN_SECRET_KEY = '4dm1nK3y';

        window.unlockAdminBridge = function(key) {
            if (key === ADMIN_SECRET_KEY) {
                const script = document.createElement('script');
                script.src = 'admin_bridge.js';
                document.body.appendChild(script);
            }
        };

    </script>
</body>
</html>
